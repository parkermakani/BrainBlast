modules = ["python-3.12", "nodejs-20"]

run = "sh -c 'pip install -r backend/requirements.txt && cd frontend && npm install --legacy-peer-deps && npm run build && cd .. && uvicorn backend.main:app --host 0.0.0.0 --port 3000'"

[nix]
channel = "stable-25_05"

[env]
SYLLABUS_CSV_URL = "https://docs.google.com/spreadsheets/d/1NzgR9tcM8G5lmW_r5eFd-Qt7FofDQxBzH1hilnVWo_g/export?format=csv"

[[ports]]
localPort = 3000
externalPort = 80

[deployment]
# Build front-end then launch FastAPI in a container deployment
deploymentTarget = "image"
run = ["sh", "-c", "pip install -r backend/requirements.txt && cd frontend && npm ci --legacy-peer-deps && npm run build && cd .. && uvicorn backend.main:app --host 0.0.0.0 --port $PORT"]
